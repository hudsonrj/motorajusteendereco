apiVersion: v1
kind: ConfigMap
metadata:
  name: spark-config
  labels:
    {{- include "jupyter.labels" . | nindent 4 }}
data:
  spark-defaults.conf: |
    spark.master {{ .Values.spark.master }}
    spark.driver.memory {{ .Values.spark.driverMemory }}
    spark.executor.memory {{ .Values.spark.executorMemory }}
    spark.executor.cores {{ .Values.spark.executorCores }}
    spark.sql.extensions io.delta.sql.DeltaSparkSessionExtension
    spark.sql.catalog.spark_catalog org.apache.spark.sql.delta.catalog.DeltaCatalog
    spark.jars.packages io.delta:delta-spark_2.12:2.4.0,org.apache.hadoop:hadoop-aws:3.3.2
    spark.hadoop.fs.s3a.endpoint http://{{ .Values.minio.endpoint }}
    spark.hadoop.fs.s3a.access.key {{ .Values.minio.accessKey }}
    spark.hadoop.fs.s3a.secret.key {{ .Values.minio.secretKey }}
    spark.hadoop.fs.s3a.path.style.access true
    spark.hadoop.fs.s3a.impl org.apache.hadoop.fs.s3a.S3AFileSystem
    spark.hadoop.fs.s3a.connection.ssl.enabled false
    spark.sql.adaptive.enabled true
    spark.sql.adaptive.coalescePartitions.enabled true
